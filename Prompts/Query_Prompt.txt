I need your help generating SPARQL queries for the ontology described below. 
I will ask you natural langauge questions to plan the analysis and you will generate queries as we go.
The ontology is for data from our manufacturing execution system, specifically toothpaste production.
My primary analysis interest is understanding unplanned downtime and overall asset effectiveness and how different factors (the line, material, etc) impact it.
We will use the queries to answer complex and insightful question and to to prep data subsets for modeling or analysis with libraries.
I am providing a description of our "asset effectiveness model" also known as OEE - overall equipment effectivness.
Framing equeries and results in the context of this model will help supply chain leadership make decisions.

We will use the python library owlready2 to load the ontology (and owl file) and issue queries.

Do you understand?

Resources available:
- the ontology specification (csv)
- a brief description of the ontoloy (txt)
- a sample of the first few entries from the owl file (owl / xml)
- owlready2 SPARQL documentation (rst)
- please ask if you need another resource

==============================
Ontology specification (csv)
==============================

Logical Group,Raw Data Column Name,Proposed OWL Entity,Proposed OWL Property,OWL Property Type,Target/Range (xsd:) / Target Class,OWL Property Characteristics,Inverse Property,Domain,Property Restrictions,ISA-95 Concept,Parent Class,Target Link Context,Notes/Considerations,Programmatic
Performance Metrics,AE_MODEL_CATEGORY,EventRecord,aeModelCategory,DatatypeProperty,xsd:string,-,,EventRecord,,OperationsPerformance Category,EventRecord,"Captures the specific AE/OEE time category assignment for the event (e.g., Runtime, Unplanned, Plant Decision).",
Performance Metrics,ALL_MAINTENANCE,EventRecord,allMaintenanceTimeMinutes,DatatypeProperty,xsd:double,Functional,,EventRecord,,OperationsPerformance Parameter,EventRecord,Total duration classified as Maintenance (in minutes). (Assumed Functional per event).,
Performance Metrics,AUTONOMOUS_MAINTENANCE,EventRecord,autonomousMaintenanceTimeMinutes,DatatypeProperty,xsd:double,Functional,,EventRecord,,OperationsPerformance Parameter,EventRecord,Duration classified as Autonomous Maintenance (in minutes). Sub-category of All Maintenance. (Assumed Functional).,
Performance Metrics,BUSINESS_EXTERNAL_TIME,EventRecord,businessExternalTimeMinutes,DatatypeProperty,xsd:double,Functional,,EventRecord,,OperationsPerformance Parameter,EventRecord,Property of EventRecord per Section 6.3. Represents Business External time in minutes. (Functional per EventRecord instance),
Utilization State/Reason,CO_ORIGINAL_TYPE,OperationalReason,originalChangeoverType,DatatypeProperty,xsd:string,-,,OperationalReason,,OperationsEvent Detail (Original),OperationalReason,Represents the original changeover type code. Allows comparison with changeoverType if needed.,
Utilization State/Reason,CO_TYPE,OperationalReason,changeoverType,DatatypeProperty,xsd:string,-,,OperationalReason,,OperationsEvent Detail,OperationalReason,Property of OperationalReason for changeover events. Categorical.,
Equipment Attributes,COMPLEXITY,Equipment,complexity,DatatypeProperty,xsd:string,-,,Equipment,,Equipment Property,Equipment,Property of Equipment according to Section 5.5.,
Time & Schedule,CREW_ID,PersonnelClass,personnelClassId,DatatypeProperty,xsd:string,Functional,,PersonnelClass,,PersonnelClass ID,owl:Thing,Added to align with Section 5.4 Personnel model.,
Performance Metrics,DOWNTIME,EventRecord,downtimeMinutes,DatatypeProperty,xsd:double,Functional,,EventRecord,,OperationsPerformance Parameter,EventRecord,Duration classified as Downtime (in minutes). (Assumed Functional per event).,
Utilization State/Reason,DOWNTIME_DRIVER,OperationalReason,downtimeDriver,DatatypeProperty,xsd:string,-,,OperationalReason,,OperationsEvent Category,OperationalReason,Property of OperationalReason per Section 5.11.,
Performance Metrics,EFFECTIVE_RUNTIME,EventRecord,effectiveRuntimeMinutes,DatatypeProperty,xsd:double,Functional,,EventRecord,,OperationsPerformance Parameter,EventRecord,Property of EventRecord per Section 6.3. Represents Effective Runtime in minutes. (Functional per EventRecord instance),
Asset Hierarchy,EQUIPMENT_ID,Equipment,equipmentId,DatatypeProperty,xsd:string,Functional,,Equipment,,Equipment ID,ProductionLine,Preferred ID for Equipment Individual. Links via isPartOfProductionLine to ProductionLine. Requires check against EQUIPMENT_TYPE.,
Equipment Attributes,EQUIPMENT_MODEL,Equipment,equipmentModel,DatatypeProperty,xsd:string,Functional,,Equipment,,Equipment Property/Model,Equipment,,Property of Equipment according to Section 5.5.
Asset Hierarchy,EQUIPMENT_NAME,Equipment,equipmentName,DatatypeProperty,xsd:string,-,,Equipment,,Equipment Description,ProductionLine,Secondary ID. Used to determine EquipmentClass. Consider rdfs:label.,
Equipment Class,EQUIPMENT_NAME,EquipmentClass,equipmentClassId,DatatypeProperty,xsd:string,Functional,,EquipmentClass,,EquipmentClass ID,owl:Thing,,"Requires parsing from EQUIPMENT_NAME to extract the class name (e.g., using logic similar to parse_equipment_class)."
Asset Hierarchy,GH_AREA,ProcessCell,processCellId,DatatypeProperty,xsd:string,Functional,,ProcessCell,,Area/ProcessCell ID,Area,Used to create/identify ProcessCell (GH_Area) Individual. Links via partOfArea to Area. Source corrected from PHYSICAL_AREA.,
Asset Hierarchy,GH_CATEGORY,Area,areaCategoryCode,DatatypeProperty,xsd:string,Functional,,Area,,Product Category,Area,"Represents the product category code (e.g., ""OC"") directly associated with the Focus Factory (Area). Marked Functional.",
Asset Hierarchy,GH_FOCUSFACTORY,Area,areaId,DatatypeProperty,xsd:string,Functional,,Area,,Area ID,Plant,Used to create/identify Area (Focus Factory) Individual. Links via locatedInPlant to Plant.,
Performance Metrics,GOOD_PRODUCTION_QTY,EventRecord,goodProductionQuantity,DatatypeProperty,xsd:integer,Functional,,EventRecord,,OperationsPerformance Parameter,EventRecord,Quantity of good units produced during the event. (Assumed Functional per event).,
Time & Schedule,JOB_END_TIME_LOC,TimeInterval,endTime,DatatypeProperty,xsd:dateTime,Functional,,TimeInterval,,SegmentResponse EndTime,TimeInterval,Part of the TimeInterval linked by EventRecord. (Functional per TimeInterval instance),
Time & Schedule,JOB_START_TIME_LOC,TimeInterval,startTime,DatatypeProperty,xsd:dateTime,Functional,,TimeInterval,,SegmentResponse StartTime,owl:Thing,EventRecord links via occursDuring to TimeInterval. (Functional per TimeInterval instance),
Asset Hierarchy,LINE_NAME,ProductionLine,lineId,DatatypeProperty,xsd:string,Functional,,ProductionLine,,ProductionLine/ProcessCell ID,ProcessCell,Links via locatedInProcessCell to ProcessCell.,
Material & Prod Order,MATERIAL_ID,Material,materialId,DatatypeProperty,xsd:string,Functional,,Material,,MaterialDefinition ID,owl:Thing,,Used to create/identify Material Individual per Section 5.7.
Material & Prod Order,MATERIAL_UOM,Material,materialUOM,DatatypeProperty,xsd:string,Functional,,Material,,MaterialDefinition BaseUnitOfMeasure,Material,Property of Material per Section 5.7. (Functional per Material instance),
Equipment Attributes,MODEL,Equipment,alternativeModel,DatatypeProperty,xsd:string,-,,Equipment,,Equipment Property,Equipment,Property of Equipment according to Section 5.5.,
Asset Hierarchy,N/A,Area,hasProcessCell,ObjectProperty,ProcessCell,-,partOfArea,Area,,Hierarchy Scope,owl:Thing,ProcessCell,Inverse of partOfArea. Links Area to its ProcessCells.
Asset Hierarchy,N/A,Area,locatedInPlant,ObjectProperty,Plant,-,hasArea,Area,,Hierarchy Scope,owl:Thing,Plant,Links an Area to the Plant it resides in.
Asset Hierarchy,N/A,Equipment,isPartOfProductionLine,ObjectProperty,ProductionLine,-,hasEquipmentPart,Equipment,,Hierarchy Scope,owl:Thing,ProductionLine,Links an Equipment instance to the ProductionLine it is part of.
Asset Hierarchy,N/A,EventRecord,involvesResource,ObjectProperty,ProductionLineOrEquipment,,resourceInvolvedIn,EventRecord,min 1,SegmentResponse Resource,EventRecord,,the link is established programmatically in Pass 1 based on the EQUIPMENT_TYPE column and the identified line_ind or equipment_ind,True
Asset Hierarchy,N/A,Plant,hasArea,ObjectProperty,Area,-,locatedInPlant,Plant,,Hierarchy Scope,owl:Thing,Area,Inverse of locatedInPlant. Links Plant to its Areas.
Asset Hierarchy,N/A,ProcessCell,containsProductionLine,ObjectProperty,ProductionLine,-,locatedInProcessCell,ProcessCell,,Hierarchy Scope,owl:Thing,ProductionLine,Inverse of locatedInProcessCell. Links ProcessCell to its ProductionLines.
Asset Hierarchy,N/A,ProcessCell,partOfArea,ObjectProperty,Area,-,hasProcessCell,ProcessCell,,Hierarchy Scope,owl:Thing,Area,Links a ProcessCell (GH_Area) to the Area (Focus Factory) it is part of.
Asset Hierarchy,N/A,ProductionLine,hasEquipmentPart,ObjectProperty,Equipment,-,isPartOfProductionLine,ProductionLine,,Hierarchy Scope,owl:Thing,Equipment,Inverse of isPartOfProductionLine. Links ProductionLine to its Equipment.
Asset Hierarchy,N/A,ProductionLine,locatedInProcessCell,ObjectProperty,ProcessCell,-,containsProductionLine,ProductionLine,,Hierarchy Scope,owl:Thing,ProcessCell,Links a ProductionLine to the ProcessCell it resides in.
Asset Hierarchy,N/A,ProductionLineOrEquipment,,,,,,,,Resource,owl:Thing,Represents a resource that can be either a ProductionLine or an Equipment. Intended as a superclass or union for the range of involvesResource.,
Asset Hierarchy,N/A,,resourceInvolvedIn,ObjectProperty,EventRecord,-,involvesResource,ProductionLineOrEquipment,,,Asset Hierarchy,EventRecord,Inverse of involvesResource. Links a line or equipment back to events it was involved in. Domain corrected.
Equipment Class,N/A,Equipment,memberOfClass,ObjectProperty,EquipmentClass,Functional,hasInstance,Equipment,,EquipmentClass Hierarchy,Equipment,EquipmentClass,Links Equipment instances to their EquipmentClass. Functional assumes equip belongs to one class.
Equipment Class,N/A,EquipmentClass,hasInstance,ObjectProperty,Equipment,-,memberOfClass,EquipmentClass,,EquipmentClass Hierarchy,owl:Thing,Equipment,Inverse of memberOfClass. Links EquipmentClass to Equipment instances.
Equipment Sequence,N/A,Equipment,actualSequencePosition,DatatypeProperty,xsd:integer,Functional,,Equipment,,Equipment Hierarchy Instance,Equipment,,Deferred/Future: Instance sequence data not available/required for V1.
Equipment Sequence,N/A,Equipment,equipmentIsDownstreamOf,ObjectProperty,Equipment,"Transitive, Asymmetric",equipmentIsUpstreamOf,Equipment,,Equipment Hierarchy Instance,Equipment,Equipment,Deferred/Future: Instance sequence data not available/required for V1.
Equipment Sequence,N/A,Equipment,equipmentIsUpstreamOf,ObjectProperty,Equipment,"Transitive, Asymmetric",equipmentIsDownstreamOf,Equipment,,Equipment Hierarchy Instance,Equipment,Equipment,Deferred/Future: Instance sequence data not available/required for V1.
Equipment Sequence,N/A,Equipment,isParallelWith,ObjectProperty,Equipment,"Symmetric, Irreflexive",,Equipment,,Equipment Hierarchy Instance,Equipment,Equipment,Deferred/Future: Not required for V1.
Equipment Sequence,N/A,EquipmentClass,classIsDownstreamOf,ObjectProperty,EquipmentClass,"Transitive, Asymmetric",classIsUpstreamOf,EquipmentClass,,Equipment Hierarchy/Topology,EquipmentClass,EquipmentClass,Defines downstream relationship between equipment classes.
Equipment Sequence,N/A,EquipmentClass,classIsUpstreamOf,ObjectProperty,EquipmentClass,"Transitive, Asymmetric",classIsDownstreamOf,EquipmentClass,,Equipment Hierarchy/Topology,EquipmentClass,EquipmentClass,Defines upstream relationship between equipment classes. Use for default sequence relative order.
Equipment Sequence,N/A,EquipmentClass,defaultSequencePosition,DatatypeProperty,xsd:integer,Functional,,EquipmentClass,,Equipment Hierarchy/Topology,EquipmentClass,,Required for V1: Numerical position in default sequence (1-based). Functional per class in sequence context.
Equipment Sequence,N/A,EquipmentClass,isParallelWith,ObjectProperty,EquipmentClass,"Symmetric, Irreflexive",,EquipmentClass,,Equipment Hierarchy/Topology,EquipmentClass,EquipmentClass,Defines equipment classes that operate in parallel. Deferred/Future: Not required for V1 linear sequence focus.
Operational Context,N/A,EventRecord,hasDetailedEquipmentEvent,ObjectProperty,EventRecord,-,isPartOfLineEvent,EventRecord,,Event Hierarchy,EventRecord,EventRecord,Required V1: Inverse of isPartOfLineEvent. Links a line-level event to the specific equipment events that comprise or explain it. Domain: EventRecord involving ProductionLine. Range: EventRecord involving Equipment.
Operational Context,N/A,EventRecord,isPartOfLineEvent,ObjectProperty,EventRecord,-,hasDetailedEquipmentEvent,EventRecord,,Event Hierarchy,EventRecord,EventRecord,Required V1: Links an equipment-specific event record to the broader line event record it occurred within or contributed to. Domain: EventRecord involving Equipment. Range: EventRecord involving ProductionLine.
Time & Schedule,N/A,EventRecord,occursDuring,ObjectProperty,TimeInterval,Functional,,EventRecord,,SegmentResponse TimeInterval,EventRecord,TimeInterval,Links EventRecord to TimeInterval. This property is essential for data population. Functional assumes event fully within one interval.
Time & Schedule,N/A,EventRecord,duringShift,ObjectProperty,Shift,Functional,,EventRecord,,PersonnelSchedule,EventRecord,Shift,Links an EventRecord to the Shift in which it occurred.
Time & Schedule,N/A,EventRecord,occursDuring,ObjectProperty,TimeInterval,Functional,,EventRecord,,SegmentResponse Time,EventRecord,TimeInterval,Links an EventRecord to the TimeInterval during which it occurred.
Utilization State/Reason,N/A,EventRecord,eventHasState,ObjectProperty,OperationalState,Functional,,EventRecord,,OperationsRecord State,EventRecord,OperationalState,Links an EventRecord to its OperationalState.
Utilization State/Reason,N/A,EventRecord,eventHasReason,ObjectProperty,OperationalReason,Functional,,EventRecord,,OperationsEvent Reason,EventRecord,OperationalReason,Links an EventRecord to its OperationalReason.
Material & Prod Order,N/A,EventRecord,producedMaterial,ObjectProperty,Material,-,isMaterialProducedIn,EventRecord,,Material Definition,EventRecord,Material,Links an EventRecord to the Material being produced during the event.
Material & Prod Order,N/A,EventRecord,consumedMaterial,ObjectProperty,Material,-,isMaterialConsumedIn,EventRecord,,Material Definition,EventRecord,Material,Links an EventRecord to the Material being consumed during the event.
Material & Prod Order,N/A,EventRecord,associatedRequest,ObjectProperty,ProductionRequest,-,hasAssociatedEvent,EventRecord,,Operations Request,EventRecord,ProductionRequest,Links an EventRecord to the ProductionRequest that it is associated with.
Material & Prod Order,N/A,Material,isMaterialProducedIn,ObjectProperty,EventRecord,-,producedMaterial,Material,,Material Definition,Material,EventRecord,Inverse of producedMaterial. Links Material to the events where it was produced.
Material & Prod Order,N/A,Material,isMaterialConsumedIn,ObjectProperty,EventRecord,-,consumedMaterial,Material,,Material Definition,Material,EventRecord,Inverse of consumedMaterial. Links Material to the events where it was consumed.
Material & Prod Order,N/A,ProductionRequest,hasAssociatedEvent,ObjectProperty,EventRecord,-,associatedRequest,ProductionRequest,,Operations Request,ProductionRequest,EventRecord,Inverse of associatedRequest. Links ProductionRequest to its associated events.
Performance Metrics,NOT_ENTERED,EventRecord,notEnteredTimeMinutes,DatatypeProperty,xsd:double,Functional,,EventRecord,,OperationsPerformance Parameter,EventRecord,Duration where state was not entered/unknown (in minutes). (Assumed Functional per event).,
Utilization State/Reason,OPERA_TYPE,EventRecord,operationType,DatatypeProperty,xsd:string,-,,EventRecord,,OperationsRecord Type,EventRecord,Property of EventRecord per Section 5.10. Categorical.,
Asset Hierarchy,PHYSICAL_AREA,Area,areaPhysicalCategoryName,DatatypeProperty,xsd:string,-,,Area,,Product Category,Area,,"Represents the descriptive product category name (e.g., ""OralCare"") directly associated with the Focus Factory (Area)."
Performance Metrics,PLANNED_MAINTENANCE,EventRecord,plannedMaintenanceTimeMinutes,DatatypeProperty,xsd:double,Functional,,EventRecord,,OperationsPerformance Parameter,EventRecord,Duration classified as Planned Maintenance (in minutes). Sub-category of All Maintenance. (Assumed Functional).,
Asset Hierarchy,PLANT,Plant,plantId,DatatypeProperty,xsd:string,Functional,,Plant,,Enterprise/Site ID,owl:Thing,Used to create/identify Plant Individual - harmonized with B2MML terminology.,
Performance Metrics,PLANT_AVAILABLE_TIME,EventRecord,plantAvailableTimeMinutes,DatatypeProperty,xsd:double,Functional,,EventRecord,,OperationsPerformance Parameter,EventRecord,Property of EventRecord per Section 6.3. Represents Plant Available time in minutes. (Functional per EventRecord instance),
Performance Metrics,PLANT_DECISION_TIME,EventRecord,plantDecisionTimeMinutes,DatatypeProperty,xsd:double,Functional,,EventRecord,,OperationsPerformance Parameter,EventRecord,Property of EventRecord per Section 6.3. Represents Plant Decision time in minutes. (Functional per EventRecord instance),
Performance Metrics,PLANT_EXPERIMENTATION,EventRecord,plantExperimentationTimeMinutes,DatatypeProperty,xsd:double,Functional,,EventRecord,,OperationsPerformance Parameter,EventRecord,Duration classified as Plant Experimentation (in minutes). (Assumed Functional per event).,
Material & Prod Order,PRIMARY_CONV_FACTOR,Material,conversionFactor,DatatypeProperty,xsd:double,Functional,,Material,,Material Property,Material,Property of Material per Section 5.7. (Functional per Material instance context),
Performance Metrics,PRODUCTION_AVAILABLE_TIME,EventRecord,productionAvailableTimeMinutes,DatatypeProperty,xsd:double,Functional,,EventRecord,,OperationsPerformance Parameter,EventRecord,Property of EventRecord per Section 6.3. Represents Production Available time in minutes. (Functional per EventRecord instance),
Material & Prod Order,PRODUCTION_ORDER_DESC,ProductionRequest,requestDescription,DatatypeProperty,xsd:string,-,,ProductionRequest,,OperationsRequest Desc,ProductionRequest,Property of ProductionRequest per Section 6.1.,
Material & Prod Order,PRODUCTION_ORDER_ID,ProductionRequest,requestId,DatatypeProperty,xsd:string,Functional,,ProductionRequest,,OperationsRequest ID,owl:Thing,Used to create/identify ProductionRequest per Section 6.1.,
Material & Prod Order,PRODUCTION_ORDER_RATE,ProductionRequest,requestRate,DatatypeProperty,xsd:double,Functional,,ProductionRequest,,OperationsRequest Prop,ProductionRequest,Property of ProductionRequest per Section 6.1. (Functional per Request instance),
Material & Prod Order,PRODUCTION_ORDER_UOM,ProductionRequest,requestRateUOM,DatatypeProperty,xsd:string,Functional,,ProductionRequest,,OperationsRequest Prop,ProductionRequest,,Property of ProductionRequest per Section 6.1. (Functional per Request instance)
Time & Schedule,RAMPUP_FLAG,EventRecord,rampUpFlag,DatatypeProperty,xsd:boolean,Functional,,EventRecord,,OperationsResponse Property,EventRecord,,Property of EventRecord per Section 6.3. (Functional per EventRecord instance)
Performance Metrics,REJECT_PRODUCTION_QTY,EventRecord,rejectProductionQuantity,DatatypeProperty,xsd:integer,Functional,,EventRecord,,OperationsPerformance Parameter,EventRecord,Quantity of reject units produced during the event. (Assumed Functional per event).,
Performance Metrics,RUN_TIME,EventRecord,runTimeMinutes,DatatypeProperty,xsd:double,Functional,,EventRecord,,OperationsPerformance Parameter,EventRecord,Duration classified as Runtime (in minutes). (Assumed Functional per event).,
Time & Schedule,SHIFT_DURATION_MIN,Shift,shiftDurationMinutes,DatatypeProperty,xsd:double,Functional,,Shift,,PersonnelSchedule Duration,Shift,Property of Shift per Personnel model. (Functional per Shift instance),
Time & Schedule,SHIFT_END_DATE_LOC,Shift,shiftEndTime,DatatypeProperty,xsd:dateTime,Functional,,Shift,,PersonnelSchedule EndTime,Shift,Property of Shift per Personnel model. (Functional per Shift instance),
Time & Schedule,SHIFT_NAME,Shift,shiftId,DatatypeProperty,xsd:string,Functional,,Shift,,PersonnelSchedule ID,owl:Thing,EventRecord links via duringShift to Shift.,
Time & Schedule,SHIFT_START_DATE_LOC,Shift,shiftStartTime,DatatypeProperty,xsd:dateTime,Functional,,Shift,,PersonnelSchedule StartTime,Shift,Property of Shift per Personnel model. (Functional per Shift instance),
Material & Prod Order,SHORT_MATERIAL_ID,Material,materialDescription,DatatypeProperty,xsd:string,-,,Material,,MaterialDefinition Description,Material,Property of Material per Section 5.7. Consider rdfs:comment.,
Material & Prod Order,SIZE_TYPE,Material,sizeType,DatatypeProperty,xsd:string,-,,Material,,Material Property,Material,Property of Material per Section 5.7.,
Performance Metrics,TOTAL_TIME,EventRecord,reportedDurationMinutes,DatatypeProperty,xsd:double,Functional,,EventRecord,,OperationsPerformance Duration,EventRecord,,Property of EventRecord per Section 6.3. Represents total event time in minutes. (Functional per EventRecord instance)
Material & Prod Order,TP_UOM,Material,targetProductUOM,DatatypeProperty,xsd:string,Functional,,Material,,Material Property (UoM),Material,Property of Material per Section 5.7. (Functional per Material instance),
Material & Prod Order,UOM_ST,Material,standardUOM,DatatypeProperty,xsd:string,Functional,,Material,,Material Property (UoM),Material,Property of Material per Section 5.7. Maps from UOM_ST. (Functional per Material instance),
Material & Prod Order,UOM_ST_SAP,Material,standardUOM,DatatypeProperty,xsd:string,Functional,,Material,,Material Property (UoM),Material,Property of Material per Section 5.7. Maps from UOM_ST_SAP. (Functional per Material instance),
Utilization State/Reason,UTIL_ALT_LANGUAGE_REASON,OperationalReason,altReasonDescription,DatatypeProperty,xsd:string (with lang tag),-,,OperationalReason,,OperationsEvent Description,OperationalReason,Property of OperationalReason per Section 5.11.,
Utilization State/Reason,UTIL_REASON_DESCRIPTION,OperationalReason,reasonDescription,DatatypeProperty,xsd:string,-,,OperationalReason,,OperationsEvent Reason,owl:Thing,Maps to Ops Event Information (Section 5.11). EventRecord links via eventHasReason.,
Utilization State/Reason,UTIL_STATE_DESCRIPTION,OperationalState,stateDescription,DatatypeProperty,xsd:string,-,,OperationalState,,OperationsRecord State,owl:Thing,,Maps to Ops Record Information (Section 5.10). EventRecord links via eventHasState.
Performance Metrics,WAITING_TIME,EventRecord,waitingTimeMinutes,DatatypeProperty,xsd:double,Functional,,EventRecord,,OperationsPerformance Parameter,EventRecord,Duration classified as Waiting (in minutes). (Assumed Functional per event).,
Infrastructure,LINE_NAME,Equipment,associatedLineId,DatatypeProperty,xsd:string,Functional,,Equipment,,ISA-95,,"Used to track which line this equipment belongs to, computed during population",True

==============================
Ontology description (txt)
==============================

Loading ontology from test.owl...
Successfully loaded ontology: http://example.com/manufacturing_ontology.owl#

--- NAMESPACES ---
test: http://example.com/manufacturing_ontology.owl#
rdf: http://www.w3.org/1999/02/22-rdf-syntax-ns#
rdfs: http://www.w3.org/2000/01/rdf-schema#
owl: http://www.w3.org/2002/07/owl#
xsd: http://www.w3.org/2001/XMLSchema#

Base IRI: http://example.com/manufacturing_ontology.owl#

--- CLASSES (15) ---
├─ Area (1 instances, 0 subclasses)
├─ ProcessCell (1 instances, 0 subclasses)
├─ Plant (1 instances, 0 subclasses)
├─ Equipment (61 instances, 0 subclasses)
├─ ProductionLine (12 instances, 0 subclasses)
├─ EventRecord (5450 instances, 0 subclasses)
├─ ProductionLineOrEquipment (0 instances, 0 subclasses)
├─ EquipmentClass (61 instances, 0 subclasses)
├─ TimeInterval (5450 instances, 0 subclasses)
├─ Shift (9 instances, 0 subclasses)
├─ OperationalState (9 instances, 0 subclasses)
├─ OperationalReason (196 instances, 0 subclasses)
├─ Material (35 instances, 0 subclasses)
├─ ProductionRequest (37 instances, 0 subclasses)
├─ PersonnelClass (0 instances, 0 subclasses)

--- OBJECT PROPERTIES (29) ---
├─ hasProcessCell (inverse: partOfArea)
│  ├─ Domain: Area
│  └─ Range: ProcessCell
├─ partOfArea (inverse: hasProcessCell)
│  ├─ Domain: ProcessCell
│  └─ Range: Area
├─ locatedInPlant (inverse: hasArea)
│  ├─ Domain: Area
│  └─ Range: Plant
├─ hasArea (inverse: locatedInPlant)
│  ├─ Domain: Plant
│  └─ Range: Area
├─ isPartOfProductionLine (inverse: hasEquipmentPart)
│  ├─ Domain: Equipment
│  └─ Range: ProductionLine
├─ hasEquipmentPart (inverse: isPartOfProductionLine)
│  ├─ Domain: ProductionLine
│  └─ Range: Equipment
├─ involvesResource (inverse: resourceInvolvedIn)
│  ├─ Domain: EventRecord
│  └─ Range: ProductionLineOrEquipment
├─ resourceInvolvedIn (inverse: involvesResource)
│  ├─ Domain: ProductionLineOrEquipment
│  └─ Range: EventRecord
├─ containsProductionLine (inverse: locatedInProcessCell)
│  ├─ Domain: ProcessCell
│  └─ Range: ProductionLine
├─ locatedInProcessCell (inverse: containsProductionLine)
│  ├─ Domain: ProductionLine
│  └─ Range: ProcessCell
├─ memberOfClass [Functional] (inverse: hasInstance)
│  ├─ Domain: Equipment
│  └─ Range: EquipmentClass
├─ hasInstance (inverse: memberOfClass)
│  ├─ Domain: EquipmentClass
│  └─ Range: Equipment
├─ equipmentIsDownstreamOf [Transitive, Symmetric, Asymmetric] (inverse: equipmentIsDownstreamOf)
│  ├─ Domain: Equipment
│  └─ Range: Equipment
├─ equipmentIsUpstreamOf [Transitive, Symmetric, Asymmetric] (inverse: equipmentIsUpstreamOf)
│  ├─ Domain: Equipment
│  └─ Range: Equipment
├─ isParallelWith [Symmetric, Reflexive, Irreflexive] (inverse: isParallelWith)
│  ├─ Domain: Equipment
│  └─ Range: Equipment
├─ classIsDownstreamOf [Transitive, Symmetric, Asymmetric] (inverse: classIsDownstreamOf)
│  ├─ Domain: EquipmentClass
│  └─ Range: EquipmentClass
├─ classIsUpstreamOf [Transitive, Symmetric, Asymmetric] (inverse: classIsUpstreamOf)
│  ├─ Domain: EquipmentClass
│  └─ Range: EquipmentClass
├─ hasDetailedEquipmentEvent (inverse: isPartOfLineEvent)
│  ├─ Domain: EventRecord
│  └─ Range: EventRecord
├─ isPartOfLineEvent (inverse: hasDetailedEquipmentEvent)
│  ├─ Domain: EventRecord
│  └─ Range: EventRecord
├─ occursDuring [Functional]
│  ├─ Domain: EventRecord
│  └─ Range: TimeInterval
├─ duringShift [Functional]
│  ├─ Domain: EventRecord
│  └─ Range: Shift
├─ eventHasState [Functional]
│  ├─ Domain: EventRecord
│  └─ Range: OperationalState
├─ eventHasReason [Functional]
│  ├─ Domain: EventRecord
│  └─ Range: OperationalReason
├─ producedMaterial (inverse: isMaterialProducedIn)
│  ├─ Domain: EventRecord
│  └─ Range: Material
├─ isMaterialProducedIn (inverse: producedMaterial)
│  ├─ Domain: Material
│  └─ Range: EventRecord
├─ consumedMaterial (inverse: isMaterialConsumedIn)
│  ├─ Domain: EventRecord
│  └─ Range: Material
├─ isMaterialConsumedIn (inverse: consumedMaterial)
│  ├─ Domain: Material
│  └─ Range: EventRecord
├─ associatedRequest (inverse: hasAssociatedEvent)
│  ├─ Domain: EventRecord
│  └─ Range: ProductionRequest
├─ hasAssociatedEvent (inverse: associatedRequest)
│  ├─ Domain: ProductionRequest
│  └─ Range: EventRecord

--- DATA PROPERTIES (58) ---
├─ aeModelCategory
│  ├─ Domain: EventRecord
│  └─ Range: <class 'str'>
├─ allMaintenanceTimeMinutes [Functional]
│  ├─ Domain: EventRecord
│  └─ Range: <class 'float'>
├─ autonomousMaintenanceTimeMinutes [Functional]
│  ├─ Domain: EventRecord
│  └─ Range: <class 'float'>
├─ businessExternalTimeMinutes [Functional]
│  ├─ Domain: EventRecord
│  └─ Range: <class 'float'>
├─ originalChangeoverType
│  ├─ Domain: OperationalReason
│  └─ Range: <class 'str'>
├─ changeoverType
│  ├─ Domain: OperationalReason
│  └─ Range: <class 'str'>
├─ complexity
│  ├─ Domain: Equipment
│  └─ Range: <class 'str'>
├─ personnelClassId [Functional]
│  ├─ Domain: PersonnelClass
│  └─ Range: <class 'str'>
├─ downtimeMinutes [Functional]
│  ├─ Domain: EventRecord
│  └─ Range: <class 'float'>
├─ downtimeDriver
│  ├─ Domain: OperationalReason
│  └─ Range: <class 'str'>
├─ effectiveRuntimeMinutes [Functional]
│  ├─ Domain: EventRecord
│  └─ Range: <class 'float'>
├─ equipmentId [Functional]
│  ├─ Domain: Equipment
│  └─ Range: <class 'str'>
├─ equipmentModel [Functional]
│  ├─ Domain: Equipment
│  └─ Range: <class 'str'>
├─ equipmentName
│  ├─ Domain: Equipment
│  └─ Range: <class 'str'>
├─ equipmentClassId [Functional]
│  ├─ Domain: EquipmentClass
│  └─ Range: <class 'str'>
├─ processCellId [Functional]
│  ├─ Domain: ProcessCell
│  └─ Range: <class 'str'>
├─ areaCategoryCode [Functional]
│  ├─ Domain: Area
│  └─ Range: <class 'str'>
├─ areaId [Functional]
│  ├─ Domain: Area
│  └─ Range: <class 'str'>
├─ goodProductionQuantity [Functional]
│  ├─ Domain: EventRecord
│  └─ Range: <class 'int'>
├─ endTime [Functional]
│  ├─ Domain: TimeInterval
│  └─ Range: <class 'datetime.datetime'>
├─ startTime [Functional]
│  ├─ Domain: TimeInterval
│  └─ Range: <class 'datetime.datetime'>
├─ lineId [Functional]
│  ├─ Domain: ProductionLine
│  └─ Range: <class 'str'>
├─ materialId [Functional]
│  ├─ Domain: Material
│  └─ Range: <class 'str'>
├─ materialUOM [Functional]
│  ├─ Domain: Material
│  └─ Range: <class 'str'>
├─ alternativeModel
│  ├─ Domain: Equipment
│  └─ Range: <class 'str'>
├─ actualSequencePosition [Functional]
│  ├─ Domain: Equipment
│  └─ Range: <class 'int'>
├─ defaultSequencePosition [Functional]
│  ├─ Domain: EquipmentClass
│  └─ Range: <class 'int'>
├─ notEnteredTimeMinutes [Functional]
│  ├─ Domain: EventRecord
│  └─ Range: <class 'float'>
├─ operationType
│  ├─ Domain: EventRecord
│  └─ Range: <class 'str'>
├─ areaPhysicalCategoryName
│  ├─ Domain: Area
│  └─ Range: <class 'str'>
├─ plannedMaintenanceTimeMinutes [Functional]
│  ├─ Domain: EventRecord
│  └─ Range: <class 'float'>
├─ plantId [Functional]
│  ├─ Domain: Plant
│  └─ Range: <class 'str'>
├─ plantAvailableTimeMinutes [Functional]
│  ├─ Domain: EventRecord
│  └─ Range: <class 'float'>
├─ plantDecisionTimeMinutes [Functional]
│  ├─ Domain: EventRecord
│  └─ Range: <class 'float'>
├─ plantExperimentationTimeMinutes [Functional]
│  ├─ Domain: EventRecord
│  └─ Range: <class 'float'>
├─ conversionFactor [Functional]
│  ├─ Domain: Material
│  └─ Range: <class 'float'>
├─ productionAvailableTimeMinutes [Functional]
│  ├─ Domain: EventRecord
│  └─ Range: <class 'float'>
├─ requestDescription
│  ├─ Domain: ProductionRequest
│  └─ Range: <class 'str'>
├─ requestId [Functional]
│  ├─ Domain: ProductionRequest
│  └─ Range: <class 'str'>
├─ requestRate [Functional]
│  ├─ Domain: ProductionRequest
│  └─ Range: <class 'float'>
├─ requestRateUOM [Functional]
│  ├─ Domain: ProductionRequest
│  └─ Range: <class 'str'>
├─ rampUpFlag [Functional]
│  ├─ Domain: EventRecord
│  └─ Range: <class 'bool'>
├─ rejectProductionQuantity [Functional]
│  ├─ Domain: EventRecord
│  └─ Range: <class 'int'>
├─ runTimeMinutes [Functional]
│  ├─ Domain: EventRecord
│  └─ Range: <class 'float'>
├─ shiftDurationMinutes [Functional]
│  ├─ Domain: Shift
│  └─ Range: <class 'float'>
├─ shiftEndTime [Functional]
│  ├─ Domain: Shift
│  └─ Range: <class 'datetime.datetime'>
├─ shiftId [Functional]
│  ├─ Domain: Shift
│  └─ Range: <class 'str'>
├─ shiftStartTime [Functional]
│  ├─ Domain: Shift
│  └─ Range: <class 'datetime.datetime'>
├─ materialDescription
│  ├─ Domain: Material
│  └─ Range: <class 'str'>
├─ sizeType
│  ├─ Domain: Material
│  └─ Range: <class 'str'>
├─ reportedDurationMinutes [Functional]
│  ├─ Domain: EventRecord
│  └─ Range: <class 'float'>
├─ targetProductUOM [Functional]
│  ├─ Domain: Material
│  └─ Range: <class 'str'>
├─ standardUOM [Functional]
│  ├─ Domain: Material
│  └─ Range: <class 'str'>
├─ altReasonDescription
│  ├─ Domain: OperationalReason
│  └─ Range: <class 'owlready2.util.locstr'>
├─ reasonDescription
│  ├─ Domain: OperationalReason
│  └─ Range: <class 'str'>
├─ stateDescription
│  ├─ Domain: OperationalState
│  └─ Range: <class 'str'>
├─ waitingTimeMinutes [Functional]
│  ├─ Domain: EventRecord
│  └─ Range: <class 'float'>
├─ associatedLineId [Functional]
│  ├─ Domain: Equipment
│  └─ Range: <class 'str'>

--- INDIVIDUALS (11323) ---
Top 5 classes by individual count:
├─ EventRecord: 5450 individuals
├─ TimeInterval: 5450 individuals
├─ OperationalReason: 196 individuals
├─ EquipmentClass: 61 individuals
├─ Equipment: 61 individuals

Sample individual properties:
├─ Plant_MX11 has 87 properties
│  ├─ hasProcessCell
│  ├─ partOfArea
│  ├─ locatedInPlant
│  ├─ hasArea
│  └─ isPartOfProductionLine
│  └─ ... and 82 more

--- CLASS RESTRICTIONS (0) ---
No class restrictions found in the ontology.

--- SPARQL QUERY TEMPLATES (4) ---

1. List individuals of a class:

PREFIX onto: <http://example.com/manufacturing_ontology.owl#>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

SELECT ?individual 
WHERE {
    ?individual rdf:type onto:Area .
}
LIMIT 10


2. Query by object property:

PREFIX onto: <http://example.com/manufacturing_ontology.owl#>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

SELECT ?subject ?object
WHERE {
    ?subject rdf:type onto:Area .
    ?object rdf:type onto:ProcessCell .
    ?subject onto:hasProcessCell ?object .
}
LIMIT 10


3. Query by data property:

PREFIX onto: <http://example.com/manufacturing_ontology.owl#>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

SELECT ?individual ?value
WHERE {
    ?individual rdf:type onto:EventRecord .
    ?individual onto:aeModelCategory ?value .
}
LIMIT 10


4. Complex query:

PREFIX onto: <http://example.com/manufacturing_ontology.owl#>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

SELECT ?individual1 ?individual2
WHERE {
    ?individual1 rdf:type onto:Area .
    ?individual2 rdf:type onto:ProcessCell .
    ?individual1 onto:hasProcessCell ?individual2 .
}
LIMIT 10

==============================
Owl File Head (owl / xml)
==============================

<?xml version="1.0"?>
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:xsd="http://www.w3.org/2001/XMLSchema#"
         xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#"
         xmlns:owl="http://www.w3.org/2002/07/owl#"
         xml:base="http://example.com/manufacturing_ontology.owl"
         xmlns="http://example.com/manufacturing_ontology.owl#">

<owl:Ontology rdf:about="http://example.com/manufacturing_ontology.owl"/>

<owl:ObjectProperty rdf:about="#hasProcessCell">
  <rdfs:domain rdf:resource="#Area"/>
  <rdfs:range rdf:resource="#ProcessCell"/>
  <owl:inverseOf rdf:resource="#partOfArea"/>
  <rdfs:comment rdf:datatype="http://www.w3.org/2001/XMLSchema#string">ISA-95 Concept: Hierarchy Scope</rdfs:comment>
  <rdfs:comment rdf:datatype="http://www.w3.org/2001/XMLSchema#string">Notes: Inverse of partOfArea. Links Area to its ProcessCells.</rdfs:comment>
</owl:ObjectProperty>

<owl:ObjectProperty rdf:about="#locatedInPlant">
  <rdfs:domain rdf:resource="#Area"/>
  <rdfs:range rdf:resource="#Plant"/>
  <owl:inverseOf rdf:resource="#hasArea"/>
  <rdfs:comment rdf:datatype="http://www.w3.org/2001/XMLSchema#string">ISA-95 Concept: Hierarchy Scope</rdfs:comment>
  <rdfs:comment rdf:datatype="http://www.w3.org/2001/XMLSchema#string">Notes: Links an Area to the Plant it resides in.</rdfs:comment>
</owl:ObjectProperty>

<owl:ObjectProperty rdf:about="#isPartOfProductionLine">
  <rdfs:domain rdf:resource="#Equipment"/>
  <rdfs:range rdf:resource="#ProductionLine"/>
  <owl:inverseOf rdf:resource="#hasEquipmentPart"/>
  <rdfs:comment rdf:datatype="http://www.w3.org/2001/XMLSchema#string">ISA-95 Concept: Hierarchy Scope</rdfs:comment>
  <rdfs:comment rdf:datatype="http://www.w3.org/2001/XMLSchema#string">Notes: Links an Equipment instance to the ProductionLine it is part of.</rdfs:comment>
</owl:ObjectProperty>

<owl:ObjectProperty rdf:about="#involvesResource">
  <rdfs:domain rdf:resource="#EventRecord"/>
  <rdfs:range rdf:resource="#ProductionLineOrEquipment"/>
  <owl:inverseOf rdf:resource="#resourceInvolvedIn"/>
  <rdfs:comment rdf:datatype="http://www.w3.org/2001/XMLSchema#string">ISA-95 Concept: SegmentResponse Resource</rdfs:comment>
  <rdfs:comment rdf:datatype="http://www.w3.org/2001/XMLSchema#string">Notes: the link is established programmatically in Pass 1 based on the EQUIPMENT_TYPE column and the identified line_ind or equipment_ind</rdfs:comment>
</owl:ObjectProperty>

<owl:ObjectProperty rdf:about="#hasArea">
  <rdfs:domain rdf:resource="#Plant"/>
  <rdfs:range rdf:resource="#Area"/>
  <owl:inverseOf rdf:resource="#locatedInPlant"/>
  <rdfs:comment rdf:datatype="http://www.w3.org/2001/XMLSchema#string">ISA-95 Concept: Hierarchy Scope</rdfs:comment>
  <rdfs:comment rdf:datatype="http://www.w3.org/2001/XMLSchema#string">Notes: Inverse of locatedInPlant. Links Plant to its Areas.</rdfs:comment>
</owl:ObjectProperty>

<owl:ObjectProperty rdf:about="#containsProductionLine">
  <rdfs:domain rdf:resource="#ProcessCell"/>
  <rdfs:range rdf:resource="#ProductionLine"/>
  <owl:inverseOf rdf:resource="#locatedInProcessCell"/>
  <rdfs:comment rdf:datatype="http://www.w3.org/2001/XMLSchema#string">ISA-95 Concept: Hierarchy Scope</rdfs:comment>
  <rdfs:comment rdf:datatype="http://www.w3.org/2001/XMLSchema#string">Notes: Inverse of locatedInProcessCell. Links ProcessCell to its ProductionLines.</rdfs:comment>
</owl:ObjectProperty>

<owl:ObjectProperty rdf:about="#partOfArea">
  <rdfs:domain rdf:resource="#ProcessCell"/>
  <rdfs:range rdf:resource="#Area"/>
  <owl:inverseOf rdf:resource="#hasProcessCell"/>
  <rdfs:comment rdf:datatype="http://www.w3.org/2001/XMLSchema#string">ISA-95 Concept: Hierarchy Scope</rdfs:comment>
  <rdfs:comment rdf:datatype="http://www.w3.org/2001/XMLSchema#string">Notes: Links a ProcessCell (GH_Area) to the Area (Focus Factory) it is part of.</rdfs:comment>
</owl:ObjectProperty>

<owl:ObjectProperty rdf:about="#hasEquipmentPart">
  <rdfs:domain rdf:resource="#ProductionLine"/>
  <rdfs:range rdf:resource="#Equipment"/>
  <owl:inverseOf rdf:resource="#isPartOfProductionLine"/>
  <rdfs:comment rdf:datatype="http://www.w3.org/2001/XMLSchema#string">ISA-95 Concept: Hierarchy Scope</rdfs:comment>
  <rdfs:comment rdf:datatype="http://www.w3.org/2001/XMLSchema#string">Notes: Inverse of isPartOfProductionLine. Links ProductionLine to its Equipment.</rdfs:comment>
</owl:ObjectProperty>

<owl:ObjectProperty rdf:about="#locatedInProcessCell">
  <rdfs:domain rdf:resource="#ProductionLine"/>
  <rdfs:range rdf:resource="#ProcessCell"/>
  <owl:inverseOf rdf:resource="#containsProductionLine"/>
  <rdfs:comment rdf:datatype="http://www.w3.org/2001/XMLSchema#string">Notes: Links a ProductionLine to the ProcessCell it resides in.</rdfs:comment>
  <rdfs:comment rdf:datatype="http://www.w3.org/2001/XMLSchema#string">ISA-95 Concept: Hierarchy Scope</rdfs:comment>
</owl:ObjectProperty>

<owl:ObjectProperty rdf:about="#resourceInvolvedIn">
  <rdfs:domain rdf:resource="#ProductionLineOrEquipment"/>
  <rdfs:range rdf:resource="#EventRecord"/>
  <owl:inverseOf rdf:resource="#involvesResource"/>
  <rdfs:comment rdf:datatype="http://www.w3.org/2001/XMLSchema#string">Notes: Inverse of involvesResource. Links a line or equipment back to events it was involved in. Domain corrected.</rdfs:comment>
</owl:ObjectProperty>

<owl:ObjectProperty rdf:about="#memberOfClass">
  <rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>
  <rdfs:domain rdf:resource="#Equipment"/>
  <rdfs:range rdf:resource="#EquipmentClass"/>
  <owl:inverseOf rdf:resource="#hasInstance"/>
  <rdfs:comment rdf:datatype="http://www.w3.org/2001/XMLSchema#string">ISA-95 Concept: EquipmentClass Hierarchy</rdfs:comment>
  <rdfs:comment rdf:datatype="http://www.w3.org/2001/XMLSchema#string">Notes: Links Equipment instances to their EquipmentClass. Functional assumes equip belongs to one class.</rdfs:comment>
</owl:ObjectProperty>


==============================
Owlready2 Docs (rst)
==============================

================================================
File: doc/sparql.rst
================================================
SPARQL queries
==============

Since version 0.30, Owlready proposes 2 methods for performing SPARQL queries: the native SPARQL engine and RDFlib.


Native SPARQL engine
********************

The native SPARQL engine automatically translates SPARQL queries into SQL queries, and then run the SQL queries with SQLite3.

The native SPARQL engine has better performances than RDFlib (about 60 times faster when tested on Gene Ontology,
but it highly depends on queries and data). It also has no dependencies and it has a much shorter start-up time.

However, it currently supports only a subset of SPARQL.


SPARQL elements supported
-------------------------

* SELECT, INSERT and DELETE queries
* UNION
* OPTIONAL
* FILTER, BIND, FILTER EXISTS, FILTER NOT EXISTS
* GRAPH clauses
* SELECT sub queries
* VALUES in SELECT queries
* All SPARQL functions and aggregation functions
* Blank nodes notations with square bracket, e.g. '[ a XXX]'
* Parameters in queries (i.e. '??' or '??1')
* Property path expressions, e.g. 'a/rdfs:subClassOf*',  excepted those listed below

SPARQL elements not supported
-----------------------------

* ASK, DESCRIBE, LOAD, ADD, MOVE, COPY, CLEAR, DROP, CONSTRUCT queries
* INSERT DATA, DELETE DATA, DELETE WHERE queries (you may use INSERT or DELETE instead)
* SERVICE (Federated queries)
* FROM, FROM NAMED keywords
* MINUS
* Property path expressions with parentheses of the following forms:

  - nested repeats, e.g. (a/p*)*
  - sequence nested inside a repeat, e.g. (p1/p2)*
  - negative property set nested inside a repeat, e.g. (!(p1 | p2))*

  i.e. repeats cannot contain other repeats, sequences and negative property sets.


Performing SPARQL queries
-------------------------

The .sparql() methods of the World object can be used to perform a SPARQL query and obtain the results.
Notice that .sparql() returns a generator, so we used here the list() function to show the results.
The list contains one row for each result found, with one or more columns (depending on the query).

::
   
   >>> # Loads Gene Ontology (~ 170 Mb), can take a moment!
   >>> go = get_ontology("http://purl.obolibrary.org/obo/go.owl").load()
   
   >>> # Get the number of OWL Class in GO
   >>> list(default_world.sparql("""
              SELECT (COUNT(?x) AS ?nb)
              { ?x a owl:Class . }
       """))
   [[60448]]


Notice that the following prefixes are automatically pre-defined:

*  rdf: -> http://www.w3.org/1999/02/22-rdf-syntax-ns#
*  rdfs: -> http://www.w3.org/2000/01/rdf-schema#
*  owl: -> http://www.w3.org/2002/07/owl#
*  xsd: -> http://www.w3.org/2001/XMLSchema#
*  obo: -> http://purl.obolibrary.org/obo/
*  owlready: -> http://www.lesfleursdunormal.fr/static/_downloads/owlready_ontology.owl#

In addition, Owlready automatically create prefixes from the last part of ontology IRI (without .owl extension),
e.g. the ontology "http://test.org/onto.owl" with be automatically associated with the "onto:" prefix.
Consequently, in most case you don't need to define prefixes (but you can still define them if you want).

The classes counted above include OWL named classes, but also some OWL constructs. One may count only named classes
using a FILTER condition and the ISIRI function, as follows:

::
   
   >>> # Get the number of OWL Class in GO
   >>> list(default_world.sparql("""
              SELECT (COUNT(?x) AS ?nb)
              { ?x a owl:Class . FILTER(ISIRI(?x)) }
       """))
   [[48535]]


We may also search for a given concept. When a query returns an entity, it returns it as an Owlready object.

::
   
   >>> # Get the "mitochondrion inheritance" concept from GO
   >>> r = list(default_world.sparql("""
              SELECT ?x
              { ?x rdfs:label "mitochondrion inheritance" . }
       """))
   >>> r
   [[obo.GO_0000001]]
   >>> mito_inher = r[0][0]

Here, the resulting object 'mito_inher' is an Owlready object (here, a Class) that can be used as any other classes in Owlready.

Owlready support simple property path expressions, such as 'rdfs:subClassOf*' or 'a/rdfs:subClassOf*'.
For example, we can get the superclasses of "mitochondrion inheritance" as follows:

::
   
   >>> list(default_world.sparql("""
              SELECT ?y
              { ?x rdfs:label "mitochondrion inheritance" .
                ?x rdfs:subClassOf* ?y }
       """))
   [[obo.GO_0000001], [obo.GO_0048308], [obo.GO_0048311], [obo.GO_0006996], [obo.GO_0007005], [obo.GO_0051646], [obo.GO_0016043], [obo.GO_0051640], [obo.GO_0009987], [obo.GO_0071840], [obo.GO_0051641], [obo.GO_0008150], [obo.GO_0051179]]

 
Or we can search for individuals belonging to the class "mitochondrion inheritance" or one of its descendants, as follows:

::
   
   >>> list(default_world.sparql("""
              SELECT ?y
              { ?x rdfs:label "mitochondrion inheritance" .
                ?y a/rdfs:subClassOf* ?x }
       """))
   []
   
(Here, we have no results because Gene Ontology does not include individuals).



INSERT queries
--------------

The ontology in which the new RDF triples are inserted can be given using a "with ontology:" block or
using the "WITH <ontology IRI> INSERT ..." syntax in SPARQL. If both are present, the "with ontology:" block takes priority.

::
   
   >>> insertion = get_ontology("http://test.org/insertion.owl")
   >>> with insertion:
   ...     default_world.sparql("""
              INSERT { ?x rdfs:label "héritage mitochondrial"@fr }
              WHERE  { ?x rdfs:label "mitochondrion inheritance" . }
              """)
   1

INSERT / DELETE queries returns the number of matches found by the WHERE part.

When running INSERT / DELETE queries, Owlready tries to update the Python objects corresponding to the modified entities,
if they were loaded from the quadstore.

The following example shows how to create new individuals with an INSERT query. It creates an individual for each subclass
of "membrane".

::
   
   >>> insertion = get_ontology("http://test.org/insertion.owl")
   >>> with insertion:
   ...     default_world.sparql("""
              INSERT { ?n rdfs:label "New individual!" . }
              WHERE  { ?x rdfs:label "membrane" .
                       ?y rdfs:subClassOf ?x .
                       BIND(NEWINSTANCEIRI(?y) AS ?n) }
              """)
   

We use here a BIND statement in order to create a new IRI, using the NEWINSTANCEIRI() function that create a new IRI for
an individual, similar to those created automatically by Owlready. You may also use the more standard UUID() SPARQL function,
which create a random arbitrary IRI.

The following example shows how to create OWL construct like restrictions with an INSERT query.

::
   
   >>> insertion = get_ontology("http://test.org/insertion.owl")
   >>> with insertion:
   ...     default_world.sparql("""
              INSERT { ?x rdfs:subClassOf [ a owl:Restriction ;
                                            owl:onProperty obo:BFO_0000050 ;
                                            owl:someValuesFrom obo:GO_0005623 ] . }
              WHERE  { ?x rdfs:label "membrane" . }
              """)
   1
   
   >>> obo.GO_0016020.label
   ['membrane']
   >>> obo.GO_0016020.is_a
   [obo.GO_0044464, obo.BFO_0000050.some(obo.GO_0005623)]

   

DELETE queries
--------------

DELETE queries are supported; they do not need to specify the ontology from which RDF triples are deleted.

::
   
   >>> default_world.sparql("""
           DELETE { ?r ?p ?o . }
           WHERE  {
               ?x rdfs:label "membrane" .
               ?x rdfs:subClassOf ?r .
               ?r a owl:Restriction .
               ?r ?p ?o .
           }
           """)

The native SPARQL engine supports queries with both a DELETE and an INSERT statement.


Parameters in SPARQL queries
----------------------------

Parameters allow to run the same query multiple times, with different parameter values.
They have two interests. First, they increase performances since the same query can be reused, thus avoiding to
parse new queries. Second, they prevent security problems by avoiding SPARQL code injection, e.g. if a string value includes
quotation marks.

Parameters can be included in the query by using double question marks, e.g. "??". Parameter values can be Owlready entities
or datatype values (int, float, string, etc.). Parameter values are passed in a list after the query:

::
   
   >>> list(default_world.sparql("""
              SELECT ?y
              { ?? rdfs:subClassOf* ?y }
       """, [mito_inher]))
   [[obo.GO_0000001], [obo.GO_0048308], [obo.GO_0048311],
    [obo.GO_0006996], [obo.GO_0007005], [obo.GO_0051646],
    [obo.GO_0016043], [obo.GO_0051640], [obo.GO_0009987],
    [obo.GO_0071840], [obo.GO_0051641], [obo.GO_0008150],
    [obo.GO_0051179]]


Parameters can also be numbered, e.g. "??1", "??2", etc. This is particularly usefull if the same parameter is used
multiple times in the query.

::
   
   >>> list(default_world.sparql("""
              SELECT ?y
              { ??1 rdfs:subClassOf* ?y }
       """, [mito_inher]))
   [[obo.GO_0000001], [obo.GO_0048308], [obo.GO_0048311],
    [obo.GO_0006996], [obo.GO_0007005], [obo.GO_0051646],
    [obo.GO_0016043], [obo.GO_0051640], [obo.GO_0009987],
    [obo.GO_0071840], [obo.GO_0051641], [obo.GO_0008150],
    [obo.GO_0051179]]


Non-standard additions to SPARQL
--------------------------------

The following functions are supported by Owlready, but not standard:

 * The SIMPLEREPLACE(a, b) function is a version of REPLACE() that does not support Regex. It works like Python or SQLite3 replace,
   and has better performances.
   
 * THE LIKE(a, b) function performs similarly to the SQL Like operator. It is more limited, but faster than the Regex SPARQL functions.
   
 * The NEWINSTANCEIRI() function create a new IRI for an instance of the class given as argument. This IRI is similar to those
   created by default by Owlready. Note that the function creates 2 RDF triples, asserting that the new individual is an
   OWL NamedIndividual and an instance of the desired class passed as argument.

 * The LOADED(iri) function returns True if the entity with the given IRI is currently loaded in Python, and False otherwise.

 * The STORID(iri) function returns the integer Store-ID used by Owlready in the quadstore for representing the entity.

 * The DATE(), TIME() and DATETIME() functions can be used to handle date and time. They behave as in SQLite3 (see https://www.sqlite.org/lang_datefunc.html).

 * The DATE_SUB(), DATE_ADD(), DATETIME_SUB and DATETIME_ADD() functions can be used to substract or add a time duration to a date or a datetime, for example : DATETIME_ADD(NOW(), "P1Y"^^xsd:duration)

In Owlready, INSERT and DELETE queries can have a GROUP BY, HAVING and/or ORDER BY clauses.
This is normally not allowed by the SPARQL specification.


Prepare SPARQL queries
----------------------

The .prepare_sparql() method of the World object can be used to prepare a SPARQL query. It returns a PreparedQuery object.

The .execute() method of the PreparedQuery can be used to execute the query. It takes as argument the list of parameters,
if any.

.. note::
   
   The .sparql() method calls .prepare_sparql(). Thus, there is no interest, in terms of performances, to use
   .prepare_sparql() instead of .sparql().

The PreparedQuery can be used to determine the type of query:

::

   >>> query = default_world.prepare_sparql("""SELECT (COUNT(?x) AS ?nb) { ?x a owl:Class . }""")
   >>> isinstance(query, owlready2.sparql.main.PreparedSelectQuery)
   True
   >>> isinstance(query, owlready2.sparql.main.PreparedModifyQuery) # INSERT and/or DELETE
   False

The following attributes are availble on the PreparedQuery object:

 * .nb_parameter: the number of parameters
 * .column_names: a list with the names of the columns in the query results, e.g. ["?nb"] in the example above.
 * .world: the world object for which the query has been prepared
 * .sql: the SQL translation of the SPARQL query

::

   >>> query.sql
   'SELECT  COUNT(q1.s), 43 FROM objs q1 WHERE q1.p=6 AND q1.o=11'
   
.. note::
   
   For INSERT and DELETE query, the .sql translation only involves the WHERE part. Insertions and deletions are
   performed in Python, not in SQL, in order to update the modified Owlready Python objects, if needed.


Open a SPARQL endpoint
----------------------

The owlready2.sparql.endpoint module can be used to open a SPARQL endpoint. It requires Flask or WSGI. It contains the EndPoint
class, that takes a World and can be used as a Flask page function.

The following script creates a SPARQL endpoint with Flask:

::
   
   import flask
   
   from owlready2 import *
   from owlready2.sparql.endpoint import *

   # Load one or more ontologies
   go = get_ontology("http://purl.obolibrary.org/obo/go.owl").load() # (~ 170 Mb), can take a moment!
   
   app = flask.Flask("Owlready_sparql_endpoint")
   endpoint = EndPoint(default_world)
   app.route("/sparql", methods = ["GET"])(endpoint)
   
   # Run the server with Werkzeug; you may use any other WSGI-compatible server
   import werkzeug.serving
   werkzeug.serving.run_simple("localhost", 5000, app)


And the following script does the same, but with WSGI:

::
   
   from owlready2 import *
   from owlready2.sparql.endpoint import *

   # Load one or more ontologies
   go = get_ontology("http://purl.obolibrary.org/obo/go.owl").load() # (~ 170 Mb), can take a moment!
   
   endpoint = EndPoint(default_world)
   app = endpoint.wsgi_app
   
   # Run the server with Werkzeug; you may use any other WSGI-compatible server
   import werkzeug.serving
   werkzeug.serving.run_simple("localhost", 5000, app)

   
You can then query the endpoint, e.g. by opening the following URL in your browser:

   `<http://localhost:5000/sparql?query=SELECT(COUNT(?x)AS%20?nb){?x%20a%20owl:Class.}>`_


Using RDFlib for executing SPARQL queries
*****************************************

The Owlready quadstore can be accessed as an RDFlib graph, which can be used to perform SPARQL queries:

::

   >>> graph = default_world.as_rdflib_graph()
   >>> r = list(graph.query("""SELECT ?p WHERE {
     <http://www.semanticweb.org/jiba/ontologies/2017/0/test#ma_pizza> <http://www.semanticweb.org/jiba/ontologies/2017/0/test#price> ?p .
   }"""))


The results can be automatically converted to Python and Owlready using the .query_owlready() method instead of .query():

::

   >>> r = list(graph.query_owlready("""SELECT ?p WHERE {
     <http://www.semanticweb.org/jiba/ontologies/2017/0/test#ma_pizza> <http://www.semanticweb.org/jiba/ontologies/2017/0/test#price> ?p .
   }"""))
